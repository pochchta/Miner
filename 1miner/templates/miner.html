<?php

namespace miner\classes;

?>

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Miner</title>
    <link href="/Miner/css/style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
	<div class="messages">
	<?php
		foreach (MinerController::getMessages() as $n => $value){
			print $value.'<br>';
		}
	?>
	</div>
	<br><br>
	<?php MinerWriter::printField(MinerController::getMiner()); ?>
	<br><br>
	<form action="/" method="POST" id="formClickField">
		<input type="hidden" name="coord">
	</form>
	<form action="/" method="POST">
		<?php
			$names = array(
				"width" => "Ширина",
				"height" => "Высота",
				"numberBombs" => "Кол-во бомб"
			);
			foreach (MinerController::getSettings() as $key => $value) {
				print "{$names[$key]} <input type='text' name='{$key}' value='{$value}'><br>";
			}
		?>
		<button name="newGame" onClick="clearImageField()">NewGame</button>
		<button name="loadGame">LoadGame</button>
		<button name="setSettings">SetSettings</button>
	</form>
	<script>
		const DEFAULT = 0;
		const FLAG = 1;
		const QUESTION = 2;
		const CLASS_NOT_VISIBLE = "cell notVisible";
		function showImageCell(elements) {
			for (var i = 0; i < elements.length; i++) {
				item = elements[i];
				cellView = localStorage.getItem(item.id);
				if (item.className != CLASS_NOT_VISIBLE) {
					if (cellView != null && cellView != DEFAULT) {
						localStorage.setItem(item.id, DEFAULT);
					}
				}
				cellView = localStorage.getItem(item.id);
				if (cellView == null || cellView == DEFAULT) {
					item.style = "";
				} else if (cellView == FLAG) {
					item.style = "background-image: url('/miner/images/flagTransp128.gif'), url('/miner/images/notVisible128.gif')";
				}
			}
		}
		function leftClickCell(item) {
			if (item.className == CLASS_NOT_VISIBLE) {
				cellView = localStorage.getItem(item.id);
				if (cellView == null || cellView == DEFAULT) {
					document.forms["formClickField"].coord.value = item.id;
					document.forms["formClickField"].submit();
				}
			}		
		}
		function rightClickCell(item) {
			if (item.className == CLASS_NOT_VISIBLE) {
				cellView = localStorage.getItem(item.id);
				if (cellView == null || cellView == DEFAULT) {
					localStorage.setItem(item.id, FLAG);
				} else if (cellView == FLAG) {
					localStorage.setItem(item.id, DEFAULT);
				}
				showImageCell([item]);
			}
		}
		function clearImageField() {
			localStorage.clear();
		}
		var elements = document.querySelectorAll(".cell");
		showImageCell(elements);
		for (var i = 0; i < elements.length; i++) {
			elements[i].onclick = function() {
				leftClickCell(this);
			}
			elements[i].oncontextmenu = function() {
				rightClickCell(this);
				return false;
			}
		}

	</script>

</body>
</html>